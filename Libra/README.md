# Libraï¼šé¢å‘ä¸­æ–‡å¤§æ¨¡å‹çš„å®‰å…¨æŠ¤æ æ¨¡å‹ (Libra: Large Chinese-based Safeguard for AI Content)

**Libra-Guard** æ˜¯ä¸€æ¬¾é¢å‘ä¸­æ–‡å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„å®‰å…¨æŠ¤æ æ¨¡å‹ã€‚Libra-Guard é‡‡ç”¨ä¸¤é˜¶æ®µæ¸è¿›å¼è®­ç»ƒæµç¨‹ï¼Œå…ˆåˆ©ç”¨å¯æ‰©å±•çš„åˆæˆæ ·æœ¬é¢„è®­ç»ƒï¼Œå†ä½¿ç”¨é«˜è´¨é‡çœŸå®æ•°æ®è¿›è¡Œå¾®è°ƒï¼Œæœ€å¤§åŒ–åˆ©ç”¨æ•°æ®å¹¶é™ä½å¯¹äººå·¥æ ‡æ³¨çš„ä¾èµ–ï¼Œå¹¶æ„å»ºäº†é¦–ä¸ªé’ˆå¯¹ä¸­æ–‡ LLM çš„å®‰å…¨åŸºå‡† â€”â€” **Libra-Test**ã€‚å®éªŒè¡¨æ˜ï¼ŒLibra-Guard åœ¨ Libra-Test ä¸Šçš„è¡¨ç°æ˜¾è‘—ä¼˜äºåŒç±»å¼€æºæ¨¡å‹ï¼ˆå¦‚ ShieldLMç­‰ï¼‰ï¼Œåœ¨å¤šä¸ªä»»åŠ¡ä¸Šå¯ä¸å…ˆè¿›å•†ç”¨æ¨¡å‹ï¼ˆå¦‚ GPT-4oï¼‰æ¥è¿‘ï¼Œä¸ºä¸­æ–‡ LLM çš„å®‰å…¨æ²»ç†æä¾›äº†æ›´å¼ºçš„æ”¯æŒä¸è¯„æµ‹å·¥å…·ã€‚

**æ¨¡å‹:**  [Libra-Guard](https://huggingface.co/collections/caskcsg/libra-guard-67765779999dab7ca25180a2)

**è¯„æµ‹é›†:**  [Libra-Test](https://huggingface.co/datasets/caskcsg/Libra-Test)

![Libra-Guard](https://github.com/caskcsg/Libra/blob/main/Libra/LibraGuard.png)

---



## âœ¨ ä¸»è¦ç‰¹æ€§ (Key Features)

1. **ä¸¤é˜¶æ®µè¯¾ç¨‹å¼è®­ç»ƒ**ï¼šå…ˆåˆ©ç”¨å¯æ‰©å±•çš„åˆæˆæ ·æœ¬è¿›è¡Œé¢„è®­ç»ƒï¼Œå†ç”¨çœŸå®æ•°æ®å¾®è°ƒï¼Œåœ¨å‡å°‘äººå·¥æ ‡æ³¨ä¾èµ–çš„åŒæ—¶æå‡æ¨¡å‹è¡¨ç°ã€‚  

2. **å¯æ‰©å±•æ•°æ®æµç¨‹**ï¼šç»“åˆçœŸå®ä¸åˆæˆæ•°æ®ï¼Œå‡å°‘äººå·¥æ ‡æ³¨å·¥ä½œé‡å¹¶å¹¿æ³›è¦†ç›–æ½œåœ¨å®‰å…¨é£é™©ã€‚  

3. **é«˜æ€§èƒ½è¡¨ç°**ï¼šåœ¨å‡†ç¡®ç‡ä¸Šæ˜¾è‘—ä¼˜äºå…¶å®ƒå¼€æºæ¨¡å‹ï¼Œå¯¹æ¯”é—­æºæ¨¡å‹äº¦å…·æœ‰ç«äº‰åŠ›ã€‚  

4. **Libra-Test**ï¼šé¦–ä¸ªä¸­æ–‡å¤§æ¨¡å‹æŠ¤æ è¯„æµ‹åŸºå‡†ï¼Œæ¶µç›–ä¸ƒå¤§å…³é”®é£é™©åœºæ™¯å’Œ 5,700+ æ¡ä¸“å®¶æ ‡æ³¨æ•°æ®ã€‚  

---

## ğŸ“Š Libra-Test

**Libra-Test** æ˜¯ä¸“ä¸ºä¸­æ–‡å¤§æ¨¡å‹æŠ¤æ è€Œæ„å»ºçš„è¯„æµ‹åŸºå‡†ï¼Œæ¶µç›–ä»¥ä¸‹ä¸‰ç§æ•°æ®æ¥æºå¹¶ç»è¿‡ä¸¥æ ¼çš„äººå·¥å®¡æ ¸ï¼š  

1. **çœŸå®æ•°æ®ï¼ˆReal Dataï¼‰**  
2. **åˆæˆæ•°æ®ï¼ˆSynthetic Dataï¼‰**  
3. **ç¿»è¯‘æ•°æ®ï¼ˆTranslated Dataï¼‰**



| **Type**          | **Safe** | **Unsafe** | **Total** |
|-------------------|----------|------------|-----------|
| Real Data         | 381      | 881        | 1,262     |
| Synthetic Data    | 583      | 884        | 1,467     |
| Translated Data   | 900      | 2,091      | 2,991     |
| **Total**         | **1,864**| **3,856**  | **5,720** |


![Libra-Test](https://github.com/caskcsg/Libra/blob/main/Libra/Libra-Test.png)

---

## ğŸ å¿«é€Ÿå¼€å§‹ (Getting Started)

ä¸‹é¢åˆ—å‡ºäº†ä½¿ç”¨æœ¬é¡¹ç›®åŠå…¶æä¾›çš„è„šæœ¬è¿›è¡Œæ¨ç†ä¸è¯„æµ‹çš„ç®€è¦æ­¥éª¤ã€‚

### ğŸ› ï¸ ç¯å¢ƒå®‰è£… (Installation)

1. å…‹éš†æœ¬ä»“åº“ï¼š  
   ```bash
   git clone https://github.com/caskcsg/Libra.git
   cd Libra
   ```
2. å®‰è£…ä¾èµ–ï¼š  
   ```bash
   pip install -r requirements.txt
   ```
---

## ğŸ“¥ æ•°æ®åŠ è½½ä¸æ ¼å¼ (Data Loading & Format)

æ‚¨å¯ä»¥ä» Hugging Face Hubä¸‹è½½å¹¶åŠ è½½ **Libra-Test** æ•°æ®é›†ï¼Œæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚  

```json
{
  "source": "queryæ¥æº",
  "category_name": "queryæœ‰å®³ç±»åˆ«",
  "sub_category_name": "queryæœ‰å®³å­ç±»åˆ«",
  "question": "query",
  "response": "response",
  "label": "å®‰å…¨æ ‡ç­¾",
  "analyze": "å®‰å…¨åˆ†æ",
  "id": "id"
}
```


---

## ğŸ¤– æ¨ç†ä¸è¯„æµ‹ (Inference & Evaluation)

### ç»“æœæ¨ç† (Result Inference)

æœ¬é¡¹ç›®æä¾›äº†å¦‚ä¸‹è„šæœ¬ç¤ºä¾‹ï¼Œå¸®åŠ©æ‚¨åœ¨æœ¬åœ°ç¯å¢ƒä¸­å®Œæˆæ¨ç†ï¼š



è„šæœ¬åä¸º `inference.py`ï¼Œå…¶ä¸»è¦å‚æ•°å¦‚ä¸‹ï¼š  

| å‚æ•° (Parameter)     | ç±»å‹ (Type) | é»˜è®¤å€¼ (Default) | è¯´æ˜ (Description)                                                                   |
|----------------------|-------------|------------------|--------------------------------------------------------------------------------------|
| `--base_model`       | str         | (å¿…å¡« Required)  | æŒ‡å®šæ¨¡å‹è·¯å¾„æˆ–åç§°ï¼Œå¦‚ `./models/Libra-Guard-7B`                                    |
| `--data_path`        | str         | (å¿…å¡« Required)  | æŒ‡å®šå¾…æ¨ç†æˆ–è¯„æµ‹çš„æ•°æ®æ–‡ä»¶ï¼ˆJSON / Parquet / æ–‡ä»¶å¤¹ï¼‰                                |
| `--batch_size`       | int         | 1                | æ¨ç†æ‰¹å¤§å°ï¼Œè§† GPU æ˜¾å­˜å’Œæ•°æ®é‡é€‚å½“è°ƒæ•´                                               |
| `--seed`             | int         | 42               | éšæœºç§å­ï¼Œä¿è¯ç»“æœå¯å¤ç°                                                              |
| `--out_path`         | str         | `./outputs`      | æ¨ç†ç»“æœä¿å­˜è·¯å¾„                                                                     |
| `--num_itera`        | int         | 1                | å¤šæ¬¡ç”Ÿæˆæˆ–å¯¹æ¯”æµ‹è¯•æ—¶å¯è®¾ç½®ä¸º >1ï¼Œä¸€èˆ¬é»˜è®¤ 1                                          |
| `--few_shot`         | int         | 0                | few-shot ç¤ºä¾‹æ•°ï¼Œå¦‚ >0 åˆ™åœ¨è¾“å…¥å‰æ·»åŠ æ¼”ç¤ºç¤ºä¾‹                                         |
| `--is_instruct`      | int         | 1                | æ˜¯å¦é‡‡ç”¨æŒ‡ä»¤é£æ ¼æ¨ç†ï¼ˆå¯ç”¨ Instruct æ¨¡æ¿ï¼‰                                           |
| `--machine_rank`     | int         | 0                | å½“å‰èŠ‚ç‚¹åºå·ï¼ˆåˆ†å¸ƒå¼æ—¶ä½¿ç”¨ï¼‰                                                          |
| `--machine_num`      | int         | 1                | èŠ‚ç‚¹æ€»æ•°ï¼ˆåˆ†å¸ƒå¼æ—¶ä½¿ç”¨ï¼‰                                                              |



**ä½¿ç”¨ç¤ºä¾‹ï¼š**  
*Usage example:*

```bash
# å•æœºå•å¡åœºæ™¯
python ./scripts/inference.py \
  --base_model ./models/Libra-Guard-7B \
  --data_path ./data/test.json \
  --batch_size 2 \
  --out_path ./outputs \
  --seed 42
```

ä¸‹é¢æ˜¯ä¸€æ®µç¤ºä¾‹ **README** ä¸­â€œè¯„æµ‹æŒ‡æ ‡è®¡ç®—â€æˆ–â€œç»“æœç»Ÿè®¡â€éƒ¨åˆ†çš„è¡¥å……ç¤ºä¾‹ï¼Œå¯ä¸ä¹‹å‰çš„æ¨ç†è„šæœ¬è¯´æ˜åˆå¹¶ä½¿ç”¨ï¼Œå¹¶æ ¹æ®æ‚¨çš„é¡¹ç›®æƒ…å†µè¿›è¡Œç›¸åº”çš„ä¿®æ”¹ã€‚

---

###  è¯„æµ‹æŒ‡æ ‡è®¡ç®— (Result Metrics Calculation)

åœ¨å®Œæˆæ¨ç†åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æœ¬é¡¹ç›®æä¾›çš„ **è®¡ç®—æŒ‡æ ‡è„šæœ¬**ï¼ˆå¦‚ `evaluate_metrics.py`ï¼‰æ¥ç»Ÿè®¡å®‰å…¨åˆ¤æ–­çš„å‡†ç¡®ç‡ç­‰æŒ‡æ ‡ã€‚è¯¥è„šæœ¬ä¼šæ ¹æ®æ‚¨çš„æ¨ç†ç»“æœæ–‡ä»¶å¤¹ä»¥åŠæ ‡æ³¨å¥½çš„æµ‹è¯•é›†æ ‡ç­¾ï¼Œè®¡ç®—å¹¶æ‰“å°å‡ºæ•´ä½“ä¸åˆ†åœºæ™¯çš„å‡†ç¡®ç‡ç­‰ä¿¡æ¯ã€‚


ä¸‹é¢ç®€è¦ä»‹ç»è„šæœ¬ä¸­çš„ä¸»è¦å‚æ•°å’ŒåŠŸèƒ½ï¼š

| å‚æ•° (Parameter)                 | ç±»å‹ (Type) | é»˜è®¤å€¼ (Default) | è¯´æ˜ (Description)                                                      |
|----------------------------------|------------|------------------|-------------------------------------------------------------------------|
| `--predict_root`                 | str        | (å¿…å¡«) Required  | æ¨ç†ç»“æœæ‰€åœ¨æ–‡ä»¶å¤¹è·¯å¾„ï¼Œè„šæœ¬ä¼šè¯»å–è¯¥æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰ `.jsonl` æˆ– `.json` æ–‡ä»¶ |
| `--label_path`                   | str        | (å¿…å¡«) Required  | æµ‹è¯•é›†æ ‡ç­¾æ–‡ä»¶ï¼ˆJSONï¼‰çš„è·¯å¾„                                            |

### ä½¿ç”¨ç¤ºä¾‹ (Usage Example)

è¯·å‚è€ƒå¦‚ä¸‹å‘½ä»¤è¿è¡Œï¼š

```bash
python ./scripts/evaluate_metrics.py \
    --predict_root ./outputs \
    --label_path ./data/test.json
```

- `--predict_root` æŒ‡å®šæ¨ç†è¾“å‡ºæ–‡ä»¶å¤¹ã€‚è„šæœ¬ä¼šè‡ªåŠ¨è¯»å–è¯¥æ–‡ä»¶å¤¹å†…æ‰€æœ‰ç»“æœæ–‡ä»¶ï¼ˆå¦‚ `0-of-1.jsonl`ç­‰ï¼‰ã€‚  
- `--label_path` ä¸ºæµ‹è¯•é›†çš„æ ‡ç­¾æ–‡ä»¶ï¼ˆJSON æ ¼å¼ï¼ŒåŒ…å«æ¯æ¡æ•°æ®çš„ `id` åŠ `label` ç­‰å­—æ®µï¼‰ã€‚  

è„šæœ¬è¿è¡Œç»“æŸåï¼Œæ‚¨å°†çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„æŒ‡æ ‡è¾“å‡ºï¼ˆåŒ…å«ä¸‰ä¸ªä¸åŒæ¥æºä»¥åŠä¸‰è€…å¹³å‡çš„å‡†ç¡®ç‡ä¸F1å€¼ï¼‰ï¼š

```
Real Data
F1-Unsafe: 0.8983
F1-Safe: 0.7739
Accuracy: 0.8597
Synthetic Data
F1-Unsafe: 0.8606
F1-Safe: 0.7939
Accuracy: 0.8337
Translated Data
F1-Unsafe: 0.9359
F1-Safe: 0.8513
Accuracy: 0.9104
Average
F1-Unsafe: 0.8983
F1-Safe: 0.8064
Accuracy: 0.8679
```


**è‡³æ­¤ï¼Œé…åˆæ¨ç†è„šæœ¬å’Œè¯„æµ‹æŒ‡æ ‡è„šæœ¬ï¼Œæ‚¨å°±å¯ä»¥å®Œæˆç«¯åˆ°ç«¯çš„è¯„æµ‹æµç¨‹ï¼šä»æ¨ç†ç»“æœçš„ç”Ÿæˆåˆ°æœ€ç»ˆå®‰å…¨æŒ‡æ ‡çš„ç»Ÿè®¡åˆ†æã€‚**  


---

## ğŸ“Š å®éªŒç»“æœ (Experimental Results)

åœ¨ä»¥ä¸‹è¡¨æ ¼ä¸­ï¼Œæˆ‘ä»¬å¯¹å¤šç§åŸºçº¿æ¨¡å‹ï¼ˆClosed-Source æ¨¡å‹ï¼ŒInstruct æ¨¡å‹ä¸ Guard æ¨¡å‹ï¼‰è¿›è¡Œäº†è¯„æµ‹ï¼Œå¹¶ä¸ **Libra Guard** çš„è¡¨ç°è¿›è¡Œäº†å¯¹æ¯”ã€‚  

| **Models**                              |                           |  **Average**  |                     | **Real**        | **Synthetic**   | **Translated**  |
|-----------------------------------------|---------------------------|---------------|---------------------|----------------------|----------------------|----------------------|
|                                         | **Accuracy**              | **$F_1$-Safe**| **$F_1$-Unsafe**    | **Accuracy**         | **Accuracy**         | **Accuracy**         |
| **Closed-Source Models**                |                           |               |                     |                      |                      |                      |
| GPT-4o                                  | 91.05%                    | 87.1%         | 93.04%              | 88.59%               | 89.78%               | 94.78%               |
| Claude-3.5-Sonnet                       | 88.82%                    | 82.34%        | 91.77%              | 88.83%               | 84.46%               | 93.18%               |
| **Instruct Models**                     |                           |               |                     |                      |                      |                      |
| Qwen-14B-Chat                           | 68.83%                    | 30.55%        | 79.79%              | 68.86%               | 57.87%               | 79.77%               |
| Qwen2.5-0.5B-Instruct                   | 63.37%                    | 6.47%         | 77.14%              | 64.82%               | 57.4%                | 67.9%                |
| Qwen2.5-1.5B-Instruct                   | 65.3%                     | 34.48%        | 75.84%              | 66.48%               | 57.19%               | 72.22%               |
| Qwen2.5-3B-Instruct                     | 71.21%                    | 49.06%        | 79.74%              | 70.6%                | 63.6%                | 79.44%               |
| Qwen2.5-7B-Instruct                     | 62.49%                    | 59.96%        | 64.09%              | 55.63%               | 53.92%               | 77.93%               |
| Qwen2.5-14B-Instruct                    | 74.33%                    | 65.99%        | 79.32%              | 66.96%               | 68.1%                | 87.93%               |
| Yi-1.5-9B-Chat                          | 51.74%                    | 54.07%        | 47.31%              | 43.34%               | 40.97%               | 70.91%               |
| **Guard Models**                        |                           |               |                     |                      |                      |                      |
| Llama-Guard3-8B                         | 39.61%                    | 48.09%        | 26.1%               | 28.45%               | 33.88%               | 56.5%                |
| ShieldGemma-9B                          | 44.03%                    | 54.51%        | 23.02%              | 31.54%               | 41.04%               | 59.51%               |
| ShieldLM-Qwen-14B-Chat                  | 65.69%                    | 65.24%        | 65.23%              | 53.41%               | 61.96%               | 81.71%               |
| Libra-Guard-Qwen-14B-Chat               | 86.48%                    | 80.58%        | 89.51%              | 85.34%               | 82.96%               | 91.14%               |
| Libra-Guard-Qwen2.5-0.5B-Instruct       | 81.46%                    | 69.29%        | 86.26%              | 82.23%               | 79.05%               | 83.11%               |
| Libra-Guard-Qwen2.5-1.5B-Instruct       | 83.93%                    | 77.13%        | 87.37%              | 83.76%               | 79.75%               | 88.26%               |
| Libra-Guard-Qwen2.5-3B-Instruct         | 84.75%                    | 78.01%        | 88.13%              | 83.91%               | 81.53%               | 88.8%                |
| Libra-Guard-Qwen2.5-7B-Instruct         | 85.24%                    | 79.41%        | 88.33%              | 84.71%               | 81.32%               | 89.7%                |
| Libra-Guard-Qwen2.5-14B-Instruct        | **86.79%**                | **80.64%**    | **89.83%**          | 85.97%               | 83.37%               | 91.04%               |
| Libra-Guard-Yi-1.5-9B-Chat              | 85.93%                    | 79.15%        | 89.2%               | 86.45%               | 82%                  | 89.33%               |

Libra Guard åœ¨å®‰å…¨æ£€æµ‹ä»»åŠ¡ä¸­æ˜¾è‘—ä¼˜äº Instruct å’Œ Guard åŸºçº¿ï¼Œé€¼è¿‘ Closed-Source åŸºçº¿ï¼Œå±•ç¤ºäº†å…¶åœ¨å¤šä¸ªåŸºå‡†å’Œæ•°æ®é›†ç±»å‹ä¸Šçš„å¼ºå¤§æ€§èƒ½ã€‚

---



## ğŸ“ å¼•ç”¨ (Citation)

å¦‚æœæœ¬é¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·å¼•ç”¨ä»¥ä¸‹è®ºæ–‡ï¼š  

```bibtex
@misc{libra,
    title = {Libra: Large Chinese-based Safeguard for AI Content},
    url = {https://github.com/caskcsg/Libra/},
    author= {Chen, Ziyang and Yu, Huimu and Wu, Xing and Lin, Yuxuan and Liu, Dongqin and Hu, Songlin},
    month = {January},
    year = {2025}
}
```
